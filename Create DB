use role sysadmin;

create database if not exists sandbox;

use database sandbox;

create schema if not exists stage_sch;
create schema if not exists clean_sch;
create schema if not exists consumption_sch;
create schema if not exists common;

use schema stage_sch;

create file format if not exists stage_sch_csv_file_format
    type='csv'
    compression='auto'
    field_delimiter=','
    record_delimiter='\n'
    skip_header=1
    field_optionally_enclosed_by = '\042'
    null_if = ('\\N');

create stage stage_sch_csv_stg
    directory =(enable = true)

create or replace tag
    common.pli_policy_tag
    allowed_values 'PII','PRICE','SENSITIVE','EMAIL'

create or replace masking policy
    common.pli_masking_policy as (pli_text string)
    returns string ->
    to_varchar('**PII**');

create or replace masking policy
    common.email_masking_policy as (pli_text string)
    returns string ->
    to_varchar('**EMAIL**');

create or replace masking policy
    common.phone_masking_policy as (pli_text string)
    returns string ->
    to_varchar('**Phone**');


list @stage_sch.stage_sch_csv_stg/initial;

